[{"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/store/constants.js":"1","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/SongsList/style.js":"2","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/index.js":"3","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/MiniPlayer/index.js":"4","/Users/fangrui360.cn/Documents/mine/cloud-music/src/api/utils.js":"5","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/NormalPlayer/index.js":"6","/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/ProgressBar/index.js":"7","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/store/reducer.js":"8","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/SongsList/index.js":"9","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Album/index.js":"10","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singer/index.js":"11","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Recommend/style.js":"12","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Recommend/index.js":"13","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singers/index.js":"14","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singers/style.js":"15","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/index.js":"16","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/style.js":"17","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Album/style.js":"18","/Users/fangrui360.cn/Documents/mine/cloud-music/src/routes/index.js":"19","/Users/fangrui360.cn/Documents/mine/cloud-music/src/store/index.js":"20","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singer/store/index.js":"21","/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/Scroll/index.js":"22","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singer/store/reducer.js":"23","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/constant.js":"24","/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/ProgressCircle/index.js":"25","/Users/fangrui360.cn/Documents/mine/cloud-music/src/assets/iconfont/iconfont.js":"26","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Home/index.js":"27","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/store/actionCreators.js":"28","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Home/style.js":"29","/Users/fangrui360.cn/Documents/mine/cloud-music/src/components/RecommendList/index.js":"30","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/store/constants.js":"31","/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Album/store/reducer.js":"32","/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/LoadingV2/index.js":"33"},{"size":461,"mtime":1613187072085,"results":"34","hashOfConfig":"35"},{"size":2320,"mtime":1613228255555,"results":"36","hashOfConfig":"35"},{"size":6521,"mtime":1613268441678,"results":"37","hashOfConfig":"35"},{"size":1731,"mtime":1613201053075,"results":"38","hashOfConfig":"35"},{"size":2665,"mtime":1613209245112,"results":"39","hashOfConfig":"35"},{"size":5862,"mtime":1613209550599,"results":"40","hashOfConfig":"35"},{"size":3696,"mtime":1613226795399,"results":"41","hashOfConfig":"35"},{"size":1433,"mtime":1613208876727,"results":"42","hashOfConfig":"35"},{"size":2293,"mtime":1613227857011,"results":"43","hashOfConfig":"35"},{"size":4552,"mtime":1613229282950,"results":"44","hashOfConfig":"35"},{"size":4615,"mtime":1613228671776,"results":"45","hashOfConfig":"35"},{"size":173,"mtime":1613228537125,"results":"46","hashOfConfig":"35"},{"size":1477,"mtime":1613228539261,"results":"47","hashOfConfig":"35"},{"size":4461,"mtime":1613228856606,"results":"48","hashOfConfig":"35"},{"size":1105,"mtime":1613228867052,"results":"49","hashOfConfig":"35"},{"size":2670,"mtime":1613228944917,"results":"50","hashOfConfig":"35"},{"size":1965,"mtime":1613228960409,"results":"51","hashOfConfig":"35"},{"size":5383,"mtime":1613229276543,"results":"52","hashOfConfig":"35"},{"size":1872,"mtime":1613269325782,"results":"53","hashOfConfig":"35"},{"size":309,"mtime":1612144575503,"results":"54","hashOfConfig":"35"},{"size":118,"mtime":1612410204554,"results":"55","hashOfConfig":"35"},{"size":4751,"mtime":1612231611306,"results":"56","hashOfConfig":"35"},{"size":563,"mtime":1612410281734,"results":"57","hashOfConfig":"35"},{"size":65,"mtime":1613187072084,"results":"58","hashOfConfig":"35"},{"size":1201,"mtime":1613187072086,"results":"59","hashOfConfig":"35"},{"size":7589,"mtime":1612144575499,"results":"60","hashOfConfig":"35"},{"size":1043,"mtime":1613187072082,"results":"61","hashOfConfig":"35"},{"size":591,"mtime":1612236973832,"results":"62","hashOfConfig":"35"},{"size":921,"mtime":1612144575496,"results":"63","hashOfConfig":"35"},{"size":1447,"mtime":1612247171049,"results":"64","hashOfConfig":"35"},{"size":107,"mtime":1612233615479,"results":"65","hashOfConfig":"35"},{"size":470,"mtime":1612323864881,"results":"66","hashOfConfig":"35"},{"size":1010,"mtime":1612173249520,"results":"67","hashOfConfig":"35"},{"filePath":"68","messages":"69","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"rn31g1",{"filePath":"70","messages":"71","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"72","messages":"73","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"74","usedDeprecatedRules":"75"},{"filePath":"76","messages":"77","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"78","messages":"79","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"80","messages":"81","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"82","messages":"83","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"84","messages":"85","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"86","messages":"87","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"88","messages":"89","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"90","messages":"91","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"92","messages":"93","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"94","messages":"95","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"96","messages":"97","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"98","messages":"99","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"100","messages":"101","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"102","messages":"103","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"104","messages":"105","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"106","messages":"107","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"108","messages":"109","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"110","messages":"111","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"112","messages":"113","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"114","messages":"115","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"116","messages":"117","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"118","messages":"119","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"120","messages":"121","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"122","messages":"123","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"124","messages":"125","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"126","messages":"127","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"128","messages":"129","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"130","messages":"131","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"132","messages":"133","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"134","messages":"135","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/store/constants.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/SongsList/style.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/index.js",["136","137"],"import React, { useRef, useState, useEffect } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport {\n  changePlayingState,\n  changeShowPlayList,\n  changeCurrentIndex,\n  changeCurrentSong,\n  changePlayList,\n  changePlayMode,\n  changeFullScreen\n} from './store/actionCreators'\nimport MiniPlayer from './MiniPlayer'\nimport NormalPlayer from './NormalPlayer'\nimport Toast from '@/baseUI/Toast'\nimport { getSongUrl, isEmptyObject, findIndex, shuffle } from '@/api/utils'\nimport { playMode } from './constant'\n\nfunction Player(props) {\n  // 目前播放时间\n  const [currentTime, setCurrentTime] = useState(0)\n  // 歌曲总时长\n  const [duration, setDuration] = useState(0)\n  // 歌曲播放进度\n  let percent = isNaN(currentTime / duration) ? 0 : currentTime / duration\n  // 记录当前的歌曲，以便于下次重渲染时比对是否是一首歌\n  const [preSong, setPreSong] = useState({})\n  const [modeText, setModeText] = useState(\"\")\n  const songReady = useRef(true)\n\n  // 绑定ref\n  const audioRef = useRef()\n  const toastRef = useRef()\n\n  const fullScreen = useSelector(state => state.player.fullScreen)\n  const playing = useSelector(state => state.player.playing)\n  const currentSong = useSelector(state => state.player.currentSong)\n  const showPlayList = useSelector(state => state.player.showPlayList)\n  const mode = useSelector(state => state.player.mode)\n  const currentIndex = useSelector(state => state.player.currentIndex)\n  const playList = useSelector(state => state.player.playList)\n  const sequencePlayList = useSelector(state => state.player.sequencePlayList)\n\n  const dispatch = useDispatch()\n\n  const togglePlayingDispatch = (data) => {\n    dispatch(changePlayingState(data))\n  }\n  const toggleFullScreenDispatch = (data) => {\n    dispatch(changeFullScreen(data))\n  }\n  const togglePlayListDispatch = (data) => {\n    dispatch(changeShowPlayList(data))\n  }\n  const changeCurrentIndexDispatch = (index) => {\n    dispatch(changeCurrentIndex(index))\n  }\n  const changeCurrentDispatch = (data) => {\n    dispatch(changeCurrentSong(data))\n  }\n  const changeModeDispatch = (data) => {\n    dispatch(changePlayMode(data))\n  }\n  const changePlayListDispatch = (data) => {\n    dispatch(changePlayList(data))\n  }\n\n  const clickPlaying = (e, state) => {\n    e.stopPropagation()\n    togglePlayingDispatch(state)\n  }\n\n  const updateTime = e => {\n    setCurrentTime(e.target.currentTime)\n  }\n\n  const onProgressChange = curPercent => {\n    const newTime = curPercent * duration\n    setCurrentTime(newTime)\n    audioRef.current.currentTime = newTime\n    if (!playing) {\n      togglePlayingDispatch(true)\n    }\n  }\n\n  // 一首歌循环\n  const handleLoop = () => {\n    audioRef.current.currentTime = 0\n    changePlayingState(true)\n    audioRef.current.play()\n  }\n\n  const handlePrev = () => {\n    // 播放列表只有一首歌时单曲循环\n    if (playList.length === 1) {\n      handleLoop()\n      return\n    }\n    let index = currentIndex - 1\n    if (index < 0) index = playList.length - 1\n    if (!playing) togglePlayingDispatch(true)\n    changeCurrentIndexDispatch(index)\n  }\n\n  const handleNext = () => {\n    // 播放列表只有一首歌时单曲循环\n    if (playList.length === 1) {\n      handleLoop()\n      return\n    }\n    let index = currentIndex + 1\n    if (index === playList.length) index = 0\n    if (!playing) togglePlayingDispatch(true)\n    changeCurrentIndexDispatch(index)\n  }\n\n  const handleEnd = () => {\n    if (mode === playMode.loop) {\n      handleLoop()\n    } else {\n      handleNext()\n    }\n  }\n\n  const changeMode = () => {\n    let newMode = (mode + 1) % 3\n    if (newMode === 0) {\n      // 顺序模式\n      changePlayListDispatch(sequencePlayList)\n      let index = findIndex(currentSong, sequencePlayList)\n      changeCurrentIndexDispatch(index)\n      setModeText(\"顺序循环\")\n    } else if (newMode === 1) {\n      // 单曲循环\n      changePlayListDispatch(sequencePlayList)\n      setModeText(\"单曲循环\")\n    } else if (newMode === 2) {\n      // 随机播放\n      let newList = shuffle(sequencePlayList)\n      let index = findIndex(currentSong, newList)\n      changePlayListDispatch(newList)\n      changeCurrentIndexDispatch(index)\n      setModeText(\"随机播放\")\n    }\n    changeModeDispatch(newMode)\n    toastRef.current.show()\n  }\n\n  const handleError = () => {\n    songReady.current = true\n    alert(\"播放出错\")\n  }\n\n  useEffect(() => {\n    if (\n      !playList.length ||\n      currentIndex === -1 ||\n      !playList[currentIndex] ||\n      playList[currentIndex].id === preSong.id ||\n      !songReady.current // 标志位为 false\n    )\n      return\n    let current = playList[currentIndex]\n    songReady.current = false // 把标志位置为 false, 表示现在新的资源没有缓冲完成，不能切歌\n    changeCurrentDispatch(current) // 赋值currentSong\n    setPreSong(current)\n    audioRef.current.src = getSongUrl(current.id)\n    setTimeout(() => {\n      // 注意，play 方法返回的是一个 promise 对象\n      audioRef.current.play().then (() => {\n        songReady.current = true\n      })\n    })\n    togglePlayingDispatch(true) // 播放状态\n    setCurrentTime(0) // 从头开始播放\n    setDuration((current.dt / 1000) | 0) // 时长\n  }, [playList, currentIndex])\n\n  useEffect(() => {\n    playing ? audioRef.current.play() : audioRef.current.pause()\n  }, [playing])\n\n  return (\n    <div>\n      {\n        isEmptyObject(currentSong) ? null : \n        <MiniPlayer\n          song={currentSong}\n          fullScreen={fullScreen}\n          playing={playing}\n          toggleFullScreen={toggleFullScreenDispatch}\n          clickPlaying={clickPlaying}\n          percent={percent}\n        /> \n      }\n      {\n        isEmptyObject(currentSong) ? null : \n        <NormalPlayer\n          song={currentSong}\n          fullScreen={fullScreen}\n          playing={playing}\n          duration={duration} // 总时长\n          currentTime={currentTime} // 播放时间\n          percent={percent} // 进度\n          toggleFullScreen={toggleFullScreenDispatch}\n          clickPlaying={clickPlaying}\n          onProgressChange={onProgressChange}\n          handlePrev={handlePrev}\n          handleNext={handleNext}\n          mode={mode}\n          changeMode={changeMode}\n        />\n      }\n      <audio\n        ref={audioRef}\n        onTimeUpdate={updateTime}\n        onEnded={handleEnd}\n        onError={handleError}\n      />\n      <Toast text={modeText} ref={toastRef} />\n    </div>\n  )\n}\n\nexport default React.memo(Player)",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/MiniPlayer/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/api/utils.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/NormalPlayer/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/ProgressBar/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/store/reducer.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/SongsList/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Album/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singer/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Recommend/style.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Recommend/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singers/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singers/style.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/style.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Album/style.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/routes/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/store/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singer/store/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/Scroll/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Singer/store/reducer.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Player/constant.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/ProgressCircle/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/assets/iconfont/iconfont.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Home/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/store/actionCreators.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Home/style.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/components/RecommendList/index.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Rank/store/constants.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/application/Album/store/reducer.js",[],"/Users/fangrui360.cn/Documents/mine/cloud-music/src/baseUI/LoadingV2/index.js",[],{"ruleId":"138","severity":1,"message":"139","line":37,"column":9,"nodeType":"140","messageId":"141","endLine":37,"endColumn":21},{"ruleId":"138","severity":1,"message":"142","line":51,"column":9,"nodeType":"140","messageId":"141","endLine":51,"endColumn":31},"no-unused-vars","'showPlayList' is assigned a value but never used.","Identifier","unusedVar","'togglePlayListDispatch' is assigned a value but never used."]